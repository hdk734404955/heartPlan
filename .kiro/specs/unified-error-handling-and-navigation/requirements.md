# 需求文档

## 介绍

本功能旨在统一客户端与后端的错误码系统，确保不同错误类型有明确的错误码和相应的用户提示信息，同时解决用户登录成功后底部tab导航不显示的问题，保证注册登录流程和刷新令牌功能的正常运行。

## 需求

### 需求 1：统一错误码系统

**用户故事：** 作为开发者，我希望客户端和后端使用统一的错误码系统，以便为用户提供一致的错误提示和处理逻辑。

#### 验收标准

1. 当后端返回错误响应时，系统应该根据统一的错误码映射表提供相应的英文错误提示
2. 当发生认证相关错误（401）时，系统应该自动清除用户认证信息并跳转到登录页面
3. 当发生客户端错误（400）时，系统应该显示具体的错误信息而不跳转页面
4. 当发生权限错误（403）时，系统应该显示权限不足的提示信息
5. 当发生服务器错误（500+）时，系统应该显示服务器错误提示并提供重试选项
6. 当发生网络错误时，系统应该显示网络连接失败的提示信息

### 需求 2：登录后导航显示修复

**用户故事：** 作为用户，我希望登录成功后能够看到底部的tab导航栏，以便正常使用应用的各个功能模块。

#### 验收标准

1. 当用户成功登录时，系统应该自动跳转到主页面并显示底部tab导航
2. 当用户刷新页面或重新打开应用时，如果已登录状态有效，系统应该显示底部tab导航
3. 当用户退出登录时，系统应该隐藏底部tab导航并跳转到登录页面
4. 当用户在未登录状态下访问需要认证的页面时，系统应该自动跳转到登录页面
5. 当用户在登录页面或注册页面时，系统不应该显示底部tab导航
6. 当用户在启动页面时，系统不应该显示底部tab导航

### 需求 3：刷新令牌机制优化

**用户故事：** 作为用户，我希望在访问令牌过期时系统能够自动刷新令牌，以便无缝继续使用应用而不需要重新登录。

#### 验收标准

1. 当访问令牌即将过期时，系统应该自动使用刷新令牌获取新的访问令牌
2. 当刷新令牌成功时，系统应该更新本地存储的令牌信息并继续原始请求
3. 当刷新令牌失败时，系统应该清除认证信息并跳转到登录页面
4. 当刷新令牌不存在或无效时，系统应该直接跳转到登录页面

### 需求 4：注册登录流程完善

**用户故事：** 作为用户，我希望注册和登录流程能够正常工作，包括表单验证、错误提示和成功后的页面跳转。

#### 验收标准

1. 当用户提交注册表单时，系统应该验证输入信息的有效性
2. 当用户进入注册第二步时，头像上传应该是可选的，不是必填项
3. 当用户在注册第二步不上传头像时，系统应该允许用户继续完成注册
4. 当注册成功时，系统应该自动保存认证信息并直接进入主页面
5. 当注册失败时，系统应该显示具体的错误信息
6. 当用户提交登录表单时，系统应该验证用户凭据
7. 当登录成功时，系统应该保存认证信息并跳转到主页面
8. 当登录失败时，系统应该显示具体的错误信息而不跳转页面

### 需求 5：错误码映射和国际化

**用户故事：** 作为用户，我希望看到英文的错误提示信息，以便更好地理解发生的问题和需要采取的行动。

#### 验收标准

1. 当系统显示错误提示时，应该使用英文文案
2. 当发生常见错误时，系统应该提供用户友好的英文错误描述
3. 当发生技术性错误时，系统应该提供简化的用户可理解的英文错误信息
4. 当需要用户采取行动时，系统应该提供明确的英文操作指引