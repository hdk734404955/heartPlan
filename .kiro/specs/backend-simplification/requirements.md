# 后端代码简化重构需求文档

## 项目介绍

当前后端项目虽然已经进行了一定程度的简化，但仍然存在一些复杂性和冗余功能。需要进一步重构，使用更多第三方插件简化代码，添加全局异常处理和统一响应格式，删除文件上传相关功能，移除用户权限系统，让整个项目更加简洁易维护。

## 需求

### 需求 1：添加MapStruct进行对象映射

**用户故事：** 作为开发者，我希望使用MapStruct自动生成DTO和实体类之间的映射代码，以便减少手动编写映射逻辑

#### 验收标准

1. 当添加MapStruct依赖时，系统应该在pom.xml中配置MapStruct相关依赖
2. 当创建映射器时，系统应该创建UserMapper接口用于User实体和DTO之间的转换
3. 当使用映射器时，系统应该在Service层使用MapStruct生成的映射器替换手动映射代码
4. 当配置映射规则时，系统应该处理复杂字段的映射逻辑（如枚举转换）
5. 当编译项目时，系统应该自动生成映射器的实现类

### 需求 2：统一响应格式

**用户故事：** 作为前端开发者，我希望所有API接口都返回统一的响应格式，以便前端能够统一处理响应数据

#### 验收标准

1. 当定义响应格式时，系统应该使用 {code: xxx, data: []||{}, message} 的统一格式
2. 当成功响应时，系统应该返回code为200，data包含实际数据，message为成功提示
3. 当错误响应时，系统应该返回相应的错误code，data为null或空对象，message为错误描述
4. 当使用全局响应处理器时，系统应该自动包装所有Controller的返回值
5. 当处理异常时，系统应该将异常信息转换为统一的响应格式

### 需求 3：删除文件上传相关功能

**用户故事：** 作为开发者，我希望删除所有文件上传相关的功能，以便简化项目结构

#### 验收标准

1. 当删除文件服务时，系统应该删除FileService.java文件
2. 当删除文件控制器时，系统应该删除FileController.java文件
3. 当删除文件配置时，系统应该删除FileUploadConfig.java文件
4. 当清理依赖时，系统应该从AuthService中移除对FileService的依赖
5. 当简化头像处理时，系统应该直接使用用户提供的头像URL，不再生成随机头像

### 需求 4：极简化用户认证系统

**用户故事：** 作为开发者，我希望极简化用户认证系统，只保留最基本的登录认证功能

#### 验收标准

1. 当实现UserDetails时，系统应该只保留必要的认证方法，getAuthorities()返回空集合
2. 当简化账户状态时，系统应该将所有账户状态检查都基于enabled字段
3. 当移除权限检查时，系统应该删除所有@PreAuthorize和权限相关的注解
4. 当简化Security配置时，系统应该移除复杂的权限配置，只保留JWT认证
5. 当处理认证时，系统应该只验证用户名密码和账户启用状态
6. 当使用Lombok时，系统应该利用@Data注解自动生成的getter方法，避免重复实现

### 需求 5：完善全局异常处理

**用户故事：** 作为开发者，我希望有完善的全局异常处理机制，能够统一处理各种异常并返回友好的错误信息

#### 验收标准

1. 当发生验证异常时，系统应该捕获并返回统一格式的错误响应，message使用英文
2. 当发生业务异常时，系统应该返回相应的错误码和英文错误消息给用户
3. 当发生系统异常时，系统应该记录中文日志便于开发调试，但返回英文错误信息给用户
4. 当发生认证异常时，系统应该返回401状态码和英文错误信息
5. 当记录日志时，系统可以使用中文记录详细的错误信息，便于开发人员调试

### 需求 6：创建BaseEntity基础实体类

**用户故事：** 作为开发者，我希望创建一个BaseEntity基础实体类，包含通用字段，以便其他实体类继承使用

#### 验收标准

1. 当创建BaseEntity时，系统应该实现Serializable接口
2. 当定义通用字段时，系统应该包含id主键、创建时间、修改时间字段
3. 当使用JPA审计时，系统应该配置@CreatedDate和@LastModifiedDate注解
4. 当其他实体继承时，系统应该让User实体继承BaseEntity
5. 当简化User实体时，系统应该移除User中重复的id、时间字段定义

### 需求 7：进一步简化User实体类

**用户故事：** 作为开发者，我希望进一步简化User实体类，移除不必要的复杂字段和验证

#### 验收标准

1. 当简化账户状态时，系统应该移除accountNonExpired、accountNonLocked、credentialsNonExpired等复杂字段
2. 当简化验证逻辑时，系统应该只保留最基本的字段验证
3. 当简化枚举时，系统应该确保枚举类型简洁明了
4. 当设置可选字段时，系统应该将avatarUrl和location设为非必填字段
5. 当优化数据库映射时，系统应该确保字段映射简洁高效

### 需求 8：最大化使用Lombok优化代码

**用户故事：** 作为开发者，我希望最大化使用Lombok注解来减少样板代码，提高代码的简洁性和可读性

#### 验收标准

1. 当定义实体类时，系统必须使用@Data注解自动生成getter、setter、toString、equals、hashCode方法
2. 当需要建造者模式时，系统必须使用@Builder注解自动生成建造者模式代码
3. 当需要构造函数时，系统必须使用@NoArgsConstructor和@AllArgsConstructor注解
4. 当需要日志时，系统必须使用@Slf4j注解自动生成日志对象
5. 当需要equals和hashCode时，系统应该使用@EqualsAndHashCode注解并合理配置

### 需求 9：保持现有项目结构

**用户故事：** 作为开发者，我希望保持现有的项目文件结构，因为它已经符合Spring Boot最佳实践

#### 验收标准

1. 当重构代码时，系统应该保持现有的包结构（config、controller、dto、entity、exception、repository、security、service、util）
2. 当添加新文件时，系统应该放在相应的包中
3. 当删除文件时，系统应该保持包结构的完整性
4. 当重命名时，系统应该保持现有的命名规范
5. 当组织代码时，系统应该遵循现有的分层架构

### 需求 10：优化项目依赖和配置

**用户故事：** 作为开发者，我希望优化项目的依赖配置，添加必要的第三方库

#### 验收标准

1. 当添加MapStruct时，系统应该在pom.xml中添加MapStruct相关依赖和编译插件配置
2. 当保留Redis依赖时，系统应该保持spring-boot-starter-data-redis依赖（后续会使用）
3. 当保留WebSocket依赖时，系统应该保持spring-boot-starter-websocket依赖（后续会使用）
4. 当优化配置时，系统应该保留RedisConfig等配置类
5. 当清理代码时，系统应该只移除真正未使用的导入和依赖

### 需求 11：删除无用文件

**用户故事：** 作为开发者，我希望删除项目中所有无用的文件，保持代码库的整洁

#### 验收标准

1. 当删除无用工具类时，系统应该删除ResponseBuilder.java和ResponseCode.java等不再使用的工具类
2. 当删除空目录标记时，系统应该删除所有.gitkeep文件
3. 当删除无用配置时，系统应该删除DataInitializer.java等不需要的配置文件
4. 当清理项目时，系统应该确保只保留实际使用的文件
5. 当验证清理结果时，系统应该确保项目编译正常且功能完整

